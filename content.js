(()=>{"use strict";const t="YTHWV_THRESHOLD",e="YTHWV_STATE",n="YTHWV_STATE_SHORTS",r="YTHWV_INDIVIDUAL_MODE",o="YTHWV_INDIVIDUAL_MODE_ENABLED",i="HIDDEN_VIDEOS_GET_MANY",s="HIDDEN_VIDEOS_SET_STATE",a="YT-HWV-WATCHED-HIDDEN",d="YT-HWV-WATCHED-DIMMED",c="YT-HWV-SHORTS-HIDDEN",l="YT-HWV-SHORTS-DIMMED",u="YT-HWV-HIDDEN-ROW-PARENT",h="YT-HWV-INDIVIDUAL-HIDDEN",m="YT-HWV-INDIVIDUAL-DIMMED",y="yt-hwv-eye-button",f="yt-hwv-has-eye-button",p={PROGRESS_BAR:[".ytd-thumbnail-overlay-resume-playback-renderer",".ytThumbnailOverlayProgressBarHostWatchedProgressBarSegment",".ytp-progress-bar-played"],SHORTS_CONTAINERS:["ytd-reel-shelf-renderer","ytd-rich-shelf-renderer[is-shorts]","ytd-rich-section-renderer:has(ytd-rich-shelf-renderer[is-shorts])","ytm-shorts-lockup-view-model-v2","ytm-shorts-lockup-view-model","ytd-rich-item-renderer:has(.shortsLockupViewModelHost)",'ytd-rich-item-renderer:has(a[href^="/shorts/"])',".ytd-rich-shelf-renderer:has(a.reel-item-endpoint)",'ytd-video-renderer:has(.ytd-thumbnail-overlay-time-status-renderer[aria-label="Shorts"])','ytd-compact-video-renderer:has(a[href^="/shorts/"])','ytd-grid-video-renderer:has(a[href^="/shorts/"])'],THUMBNAILS:["yt-thumbnail-view-model:not(.yt-hwv-has-eye-button)","ytd-thumbnail:not(.yt-hwv-has-eye-button)"],VIDEO_CONTAINERS:["ytd-rich-item-renderer","ytd-video-renderer","ytd-grid-video-renderer","ytd-compact-video-renderer","yt-lockup-view-model","ytm-shorts-lockup-view-model"],TITLE_ELEMENTS:["#video-title","#video-title-link","a#video-title","h3.title","h3 a","h4 a",".title-and-badge a","ytm-shorts-lockup-view-model-v2 .shortsLockupViewModelHostTextContent","yt-formatted-string#video-title","span#video-title"]};function v(...t){false}let E={threshold:10,watchedStates:{},shortsStates:{},individualMode:"dimmed",individualModeEnabled:!0};async function S(){const i=await chrome.storage.sync.get(null);E.threshold=i[t]||10,E.individualMode=i[r]||"dimmed",E.individualModeEnabled=void 0===i[o]||i[o];["misc","subscriptions","channel","watch","trending","playlist"].forEach(t=>{E.watchedStates[t]=i[`${e}_${t}`]||"normal","playlist"!==t&&(E.shortsStates[t]=i[`${n}_${t}`]||"normal")}),v()}function b(){return E.individualModeEnabled}const w=new Map,g=new Map,A=new Map;function D(t){return t&&Number.isFinite(t.updatedAt)?t.updatedAt:-1}function T(t,e){if(t){if(e){const n=D(e);return w.set(t,e),void g.set(t,-1===n?Date.now():n)}w.delete(t),g.set(t,Date.now())}}function I(t){return t&&w.get(t)||null}function L(){const{href:t}=window.location;return t.includes("/watch?")?"watch":t.match(/.*\/(user|channel|c)\/.+\/videos/u)||t.match(/.*\/@.*/u)?"channel":t.includes("/feed/subscriptions")?"subscriptions":t.includes("/feed/trending")?"trending":t.includes("/playlist?")?"playlist":"misc"}function H(){const t=[];p.PROGRESS_BAR.forEach(e=>{document.querySelectorAll(e).forEach(e=>{t.includes(e)||t.push(e)})});const e=E.threshold,n=t.filter(t=>t.style.width&&parseInt(t.style.width,10)>=e);return v((t.length,n.length)),n}function N(){if(document.querySelectorAll(`.${d}`).forEach(t=>t.classList.remove(d)),document.querySelectorAll(`.${a}`).forEach(t=>t.classList.remove(a)),window.location.href.indexOf("/feed/history")>=0)return;const t=L(),e=function(t){return E.watchedStates[t]}(t)||"normal";"normal"!==e&&H().forEach(n=>{let r,o;if("subscriptions"===t)r=n.closest(".ytd-grid-renderer")||n.closest(".ytd-item-section-renderer")||n.closest(".ytd-rich-grid-row")||n.closest(".ytd-rich-grid-renderer")||n.closest("#grid-container"),r?.classList.contains("ytd-item-section-renderer")&&r.closest("ytd-item-section-renderer")?.classList.add(u);else if("playlist"===t)r=n.closest("ytd-playlist-video-renderer");else if("watch"===t){r=n.closest("ytd-compact-video-renderer"),r?.closest("ytd-compact-autoplay-renderer")&&(r=null);const t=n.closest("ytd-playlist-panel-video-renderer");!r&&t&&(o=t)}else r=n.closest("ytd-rich-item-renderer")||n.closest("ytd-video-renderer")||n.closest("ytd-grid-video-renderer")||n.closest("ytm-video-with-context-renderer")||n.closest("ytm-item-section-renderer");r&&("dimmed"===e?r.classList.add(d):"hidden"===e&&r.classList.add(a)),!o||"dimmed"!==e&&"hidden"!==e||o.classList.add(d)})}function M(){document.querySelectorAll(`.${l}`).forEach(t=>t.classList.remove(l)),document.querySelectorAll(`.${c}`).forEach(t=>t.classList.remove(c));const t=function(t){return E.shortsStates[t]}(L())||"normal";if("normal"===t)return;(function(){const t=[],e=new Set;return p.SHORTS_CONTAINERS.forEach(n=>{try{document.querySelectorAll(n).forEach(n=>{const r=n.tagName+n.className;if(!e.has(r)){e.add(r);const o=n.closest("ytd-reel-shelf-renderer")||n.closest("ytd-rich-shelf-renderer")||n.closest("ytd-rich-section-renderer");o&&!t.includes(o)?t.push(o):o||t.includes(n)||t.push(n)}})}catch(t){v()}}),document.querySelectorAll('a.reel-item-endpoint, a[href^="/shorts/"]').forEach(e=>{const n=e.closest("ytd-rich-item-renderer")||e.closest("ytd-video-renderer")||e.closest("ytd-compact-video-renderer")||e.closest("ytd-grid-video-renderer");n&&!t.includes(n)&&t.push(n)}),document.querySelectorAll('.ytd-thumbnail-overlay-time-status-renderer[aria-label="Shorts"]').forEach(e=>{const n=e.closest("ytd-video-renderer")||e.closest("ytd-compact-video-renderer")||e.closest("ytd-grid-video-renderer");n&&!t.includes(n)&&t.push(n)}),document.querySelectorAll("ytd-rich-shelf-renderer").forEach(e=>{(e.querySelector('a[href^="/shorts/"]')||e.querySelector(".reel-item-endpoint")||e.querySelector(".shortsLockupViewModelHost"))&&!t.includes(e)&&t.push(e)}),v(t.length),t})().forEach(e=>{"dimmed"===t?e.classList.add(l):"hidden"===t&&e.classList.add(c)})}async function V(t,e={}){try{const n=await chrome.runtime.sendMessage({type:t,...e});if(!n||!n.ok)throw new Error(n?.error||"hidden video message failed");return n.result}catch(t){throw v(),t}}async function O(t){const e=Array.isArray(t)?t.filter(Boolean):[];if(0===e.length)return{};const n=Array.from(new Set(e)),r={},o=[],s=[];if(n.forEach(t=>{!function(t){return w.has(t)}(t)?!function(t){return A.has(t)}(t)?o.push(t):s.push(function(t){return A.get(t)}(t).then(e=>{r[t]=e})):r[t]=I(t)}),o.length>0){const t=V(i,{ids:o}).then(t=>{const e=t.records||{};return o.forEach(t=>{!function(t,e){if(!t)return;const n=D(e);if(g.has(t)&&n<=g.get(t))return;if(e)return w.set(t,e),void g.set(t,-1===n?Date.now():n);w.delete(t)}(t,e[t]||null),r[t]=I(t)}),e}).finally(()=>{o.forEach(t=>function(t){A.delete(t)}(t))});o.forEach(e=>{const n=t.then(()=>I(e));!function(t,e){A.set(t,e)}(e,n),s.push(n.then(t=>{r[e]=t}))})}return s.length>0&&await Promise.all(s),r}async function _(t,e,n){const r=t?String(t).trim():"";if(!r)return null;const o={videoId:r,state:e,title:n||""},i=await V(s,o);return i&&i.record?(T(r,i.record),i.record):(T(r,null),null)}function q(t){if(!t)return"";for(const e of p.TITLE_ELEMENTS){const n=t.querySelector(e);if(n&&!n.classList.contains(y)){const t=n.getAttribute("title")||n.getAttribute("aria-label")||n.textContent?.trim()||"";return t?t.includes(" - ")?t.split(" - ")[0]:t.includes(" by ")?t.split(" by ")[0]:t:""}}return""}function R(t,e){t&&(t.classList.remove("dimmed","hidden"),"dimmed"===e?t.classList.add("dimmed"):"hidden"===e&&t.classList.add("hidden"))}function W(t,e){if(!e)return null;const n=document.createElement("button");n.className=y,n.setAttribute("data-video-id",e),n.setAttribute("tabindex","-1"),n.setAttribute("aria-label","Toggle video visibility");const r=I(e);return R(n,r?.state||"normal"),r||O([e]).then(()=>{const t=I(e);R(n,t?.state||"normal")}).catch(()=>{}),n.innerHTML='\n    <svg viewBox="0 0 24 24">\n      <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>\n    </svg>\n  ',n.addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation();const r=I(e),o="normal"===(r?.state||"normal")?E.individualMode:"normal",i=n.closest(p.VIDEO_CONTAINERS.join(", "));i&&i.setAttribute("data-ythwv-video-id",e);const s=q(i),a=await async function(t,e,n=null){return t?_(t,e,n||void 0):null}(e,o,s),d=a?a.state:"normal";R(n,d),i&&(i.classList.remove(m,h),"dimmed"===d?i.classList.add(m):"hidden"===d&&i.classList.add(h));const c=new CustomEvent("yt-hwv-individual-update");document.dispatchEvent(c)}),n}function x(){if(!b()){document.querySelectorAll(`.${y}`).forEach(t=>t.remove());return void document.querySelectorAll(`.${f}`).forEach(t=>t.classList.remove(f))}const t=document.querySelectorAll(p.THUMBNAILS.join(", "));v(t.length),t.forEach(t=>{if(t.querySelector(`.${y}`))return;const e=t.closest("a")||t.querySelector("a");if(!e)return;const n=e.getAttribute("href");if(!n)return;let r=null;const o=n.match(/\/watch\?v=([^&]+)/),i=n.match(/\/shorts\/([^?]+)/);if(o?r=o[1]:i&&(r=i[1]),!r)return;const s=W(0,r);if(!s)return;t.style.position="relative",t.appendChild(s),t.classList.add(f),t.setAttribute("data-ythwv-video-id",r);const a=t.closest(p.VIDEO_CONTAINERS.join(", "));a&&a.setAttribute("data-ythwv-video-id",r),O([r]).then(()=>{const e=I(r);if(!e||e.title)return;const n=t.closest(p.VIDEO_CONTAINERS.join(", "));n&&n.setAttribute("data-ythwv-video-id",r);const o=q(n);o&&"Toggle video visibility"!==o&&async function(t,e,n=null){t&&_(t,e,n||void 0)}(r,e.state,o)}).catch(()=>{}),v()}),document.querySelectorAll(`.${y}`).forEach(t=>{const e=t.closest('[aria-hidden="true"]');e&&e.removeAttribute("aria-hidden")})}let $=0;async function C(){if(!b())return void document.querySelectorAll(`.${m}, .${h}`).forEach(t=>{t.classList.remove(m,h)});$+=1;const t=$,e=function(){const t=new Set;return document.querySelectorAll("[data-ythwv-video-id]").forEach(e=>{const n=e.getAttribute("data-ythwv-video-id");n&&t.add(n)}),document.querySelectorAll('a[href*="/watch?v="], a[href*="/shorts/"]').forEach(e=>{const n=function(t){if(!t)return null;const e=t.match(/\/watch\?v=([^&]+)/);if(e)return e[1];const n=t.match(/\/shorts\/([^?]+)/);return n?n[1]:null}(e.getAttribute("href"));n&&t.add(n)}),Array.from(t)}();if(0!==e.length){try{await O(e)}catch(t){return void v()}t===$&&e.forEach(t=>{const e=I(t),n=e?.state||"normal",r=function(t){const e=new Set;return document.querySelectorAll(`.${y}[data-video-id="${t}"]`).forEach(t=>{const n=t.closest(p.VIDEO_CONTAINERS.join(", "));n&&e.add(n)}),document.querySelectorAll(`a[href*="/watch?v=${t}"], a[href*="/shorts/${t}"]`).forEach(t=>{const n=t.closest(p.VIDEO_CONTAINERS.join(", "));n&&e.add(n)}),Array.from(e)}(t);r.forEach(t=>{!function(t,e){if(!t)return;const n=t.classList.contains(m),r=t.classList.contains(h);"dimmed"===e?(r&&t.classList.remove(h),n||t.classList.add(m)):"hidden"===e?(n&&t.classList.remove(m),r||t.classList.add(h)):(n&&t.classList.remove(m),r&&t.classList.remove(h))}(t,n)})})}}function Y(t){if(t&&t.type)return"updated"===t.type&&t.record?(T(t.record.videoId,t.record),document.querySelectorAll(`.${y}[data-video-id="${t.record.videoId}"]`).forEach(e=>{R(e,t.record.state)}),void C()):"removed"===t.type&&t.videoId?(T(t.videoId,null),document.querySelectorAll(`.${y}[data-video-id="${t.videoId}"]`).forEach(t=>{R(t,"normal")}),void C()):void("cleared"===t.type&&(w.clear(),g.clear(),document.querySelectorAll(`.${y}`).forEach(t=>{R(t,"normal")}),C()))}function k(){v(),N(),M(),setTimeout(()=>{x(),C()},500)}function B(t,e){let n;return function(...r){clearTimeout(n),n=setTimeout(()=>t.apply(this,r),e)}}async function U(){!function(){const t="yt-hwv-styles";if(document.getElementById(t))return;const e=document.createElement("style");e.id=t,e.textContent="\n    .YT-HWV-WATCHED-HIDDEN { display: none !important }\n    .YT-HWV-WATCHED-DIMMED { opacity: 0.3 }\n    .YT-HWV-SHORTS-HIDDEN { display: none !important }\n    .YT-HWV-SHORTS-DIMMED { opacity: 0.3 }\n    .YT-HWV-HIDDEN-ROW-PARENT { padding-bottom: 10px }\n    .YT-HWV-INDIVIDUAL-HIDDEN { display: none !important }\n    .YT-HWV-INDIVIDUAL-DIMMED { opacity: 0.3 }\n\n    .yt-hwv-eye-button {\n      position: absolute !important;\n      top: 8px !important;\n      left: 50% !important;\n      transform: translateX(-50%) !important;\n      z-index: 999 !important;\n      background: rgba(0, 0, 0, 0.7) !important;\n      border: 1px solid rgba(255, 255, 255, 0.1) !important;\n      border-radius: 6px !important;\n      padding: 6px 8px !important;\n      cursor: pointer !important;\n      display: flex !important;\n      align-items: center !important;\n      justify-content: center !important;\n      transition: all 0.2s ease !important;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.3) !important;\n      opacity: 0.3 !important;\n    }\n\n    .yt-hwv-eye-button:hover {\n      opacity: 1 !important;\n      background: rgba(0, 0, 0, 1) !important;\n      transform: translateX(-50%) scale(1.1) !important;\n      box-shadow: 0 4px 8px rgba(0,0,0,0.7) !important;\n    }\n\n    .yt-hwv-eye-button svg {\n      width: 20px !important;\n      height: 20px !important;\n      fill: white !important;\n      pointer-events: none !important;\n    }\n\n    .yt-hwv-eye-button.hidden svg {\n      fill: #ff4444 !important;\n    }\n\n    .yt-hwv-eye-button.dimmed svg {\n      fill: #ffaa00 !important;\n    }\n\n    ytd-thumbnail, yt-thumbnail-view-model, #dismissible, #thumbnail-container {\n      position: relative !important;\n    }\n  ",document.head.appendChild(e)}(),await S(),k(),function(t){const e=B(t,250),n=new MutationObserver(t=>{let n=!1;if(t.forEach(t=>{if("attributes"===t.type&&"aria-hidden"===t.attributeName){const e=t.target;"true"===e.getAttribute("aria-hidden")&&e.querySelector(`.${y}`)&&e.removeAttribute("aria-hidden")}else"childList"===t.type&&(n=!0)}),n){if(1===t.length&&(t[0].target.classList?.contains(d)||t[0].target.classList?.contains(a)||t[0].target.classList?.contains(l)||t[0].target.classList?.contains(c)))return;e()}});n.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-hidden"]})}(k),function(t){const e=B(t,100),n=XMLHttpRequest.prototype.open,r=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(t,e){return this._url=e,n.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){return this.addEventListener("readystatechange",function(){4===this.readyState&&this._url&&(this._url.includes("browse_ajax")||this._url.includes("browse?"))&&setTimeout(e,100)}),r.apply(this,arguments)}}(k),function(t){const e=B(t,100);let n=location.href;const r=new MutationObserver(()=>{const t=location.href;t!==n&&(n=t,setTimeout(e,100))});r.observe(document,{subtree:!0,childList:!0})}(k),chrome.runtime.onMessage.addListener(async(t,e,n)=>{"settingsUpdated"===t.action||"resetSettings"===t.action?(await S(),k()):"HIDDEN_VIDEOS_EVENT"===t.type&&Y(t.event)}),document.addEventListener("yt-hwv-individual-update",()=>{C()})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",U):U(),v()})();
//# sourceMappingURL=content.js.map